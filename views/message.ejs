<div id="user-table">
  <thead class="table-dark">
    <a href="/message/received">받은편지함</a> |
    <a href="/message/sent">보낸편지함</a> |
    <a href="/message/unread">안읽은편지함</a>
  </thead>
  <% messages.forEach(message=> { %>
    <tbody>
      <details onclick="detail(<%= message.message_id %>)">
        <summary>
          <tr>
            <td>
              <%= message.content %>
            </td>
            <td>
              <%= message.send_user.nickname %>
            </td>
            <td>
              <%= message.created_at %>
            </td>
          </tr>
        </summary>

        <%= message.content %>
          <% if (message.sender_id!==userId){ %>
            <button onclick="modalF(<%= message.message_id %>)" id="btn-modal">답장</button>
          <% } %>
          <button onclick="deleteMessage(<%= message.message_id %>)" id="target_btn" class="btn btn-outline-primary"
            type="button">삭제</button>
            <div class="popup-wrapper">
              <div id="popup-container">
                  <h5>Contact Us</h5>
                  <form>
                      <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" class="form-control">
                      </div>
                      <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" class="form-control">
                      </div>
                      <div class="form-group">
                          <label for="message">Message</label>
                          <textarea class="form-control"></textarea>
                      </div>
                  </form>
                  <div class="modal-footer">
                    <button class="btn btn-primary btn-block">Submit</button>
                    <p><a herf="javascript:void(0)" onclick="toggle_visibility('contact-popup');">Close Popup</a></p>
                  </div>
              </div>
      </details>
    </tbody>

    
    <% }) %>
</div>


<script>
  //Modal Popup Controller
function toggle_visibility(id){
    var e = document.getElementById(id);

if(e.style.display == 'block')
    e.style.display = 'none';
else 
    e.style.display = 'block';
}
  function sendMessage(sender_id) {
    const inputContent = $('#inputContent').val();
    console.log("rec", sender_id, typeof (sender_id))
    console.log("input", inputContent)
    if (!inputContent) {
      alert('내용을 입력해주세요.');
    } else {
      $.ajax({
        type: 'POST',
        url: '/messages',
        data: JSON.stringify({
          content: inputContent,
          recipient_id: Number(sender_id)
        }),
        success: function (response) {

          alert('전송이 완료되었습니다.');

        },
        beforeSend: function (xhrObj) {
          xhrObj.setRequestHeader("Content-Type", "application/json");
          xhrObj.setRequestHeader("Accept", "application/json");
        },
      })
    }
  }
  function deleteMessage(message_id) {
    console.log("message.ejs", message_id)
    $.ajax({
      type: 'DETELE',
      url: `/messages/:${message_id}`,
      success: function (data) {
        alert("삭제완료")
        return data;
      },
    })
  }
  function detail(message_id) {
    $.ajax({
      type: 'GET',
      url: `/messages/:${message_id}`,
      success: function (data) {
        return data;
      }
    })

  }
  
</script>

<style>
.popup-position{
    display:none;
    position: fixed;
    top: 0;
    left: 0;
    background-color: rgba(0,0,0,0.7);
    width: 100%;
    height: 100%;
 
}
#popup-wrapper{
text-align: left;
}

#popup-container{

    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    width: 300px;
    margin: 70px auto;

    a{
        cursor: pointer;
    }
}
</style>