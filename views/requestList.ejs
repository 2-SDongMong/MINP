
<section style="width: 90%; margin: 30px auto; justify-content: center;">
    <div>
		<div class="d-flex justify-content-center">
			<h1 class="text-center">품앗이 구해요</h1>
		</div>
		<br/>
		<div class="d-flex justify-content-between">
			<div class="" id="">
			  <div class="">
				현재 위치: <span>고양시</span>
			  </div>
			</div>
			<div>
				<button onclick="location.href='/request/post'" type="button" class="btn btn-outline-dark">품앗이 신청하러 가기</button>
			</div>
		</div>

		<br/>

		<div class="request-cards-container" >
			<% for (let i = 0; i < 8; i++) { 
				const request = requests[i]; 
				const minutesAgo = (Date.now() - new Date(request.updated_at)) / 1000 / 60 - (60 * 9)
				let updated = ''
				if (minutesAgo < 60) {
					updated += parseInt(minutesAgo) + '분'
				} else if (minutesAgo / 60 <= 48) {
					updated += parseInt(minutesAgo / 60) + '시간'
				} else {
					updated += minutesAgo / 60 / 24 + '일'
				} 

				let reserved_dates = ''
				if (request.reserved_end_date == request.reserved_begin_date) {
					reserved_dates = request.reserved_begin_date;
				} else {
					reserved_dates = request.reserved_begin_date + ' ~ ' + request.reserved_end_date;
				}
				%>

				<div class="col">
					<div class="card h-100" style="border-radius: 20px">

						<div class="cat-card">
							<div class="imgContainer" style="background-image: url('<%= request.user.cats[0].image %>');">
							<img src="" alt="">
							<div class="status">
								<p onclick="location.href='/requestDetail/<%= request.request_id %>'">모집중</p>
							</div>
							</div>
							<div class="whole-column-container">
								<div class="cat-info-title" id="period">
									기간
								</div>
								<div class="cat-info-content">
									<%= reserved_dates %> 
								</div>
							</div>
							<div class="whole-column-container">
								<div class="cat-info-title" id="name">
								연락
								</div>
								<div class="cat-info-content">
								<%= request.user.nickname %>
								</div>
							</div>
							<div class="whole-column-container">
								<div class="cat-info-title" id="character">
									지역
								</div>
								<div class="cat-info-content">
									<%= request.request_id %>
								</div>
							</div>
							
							<div class="more">
								<small class="text-muted align-center"><%= updated %> 전 업데이트</small>
								<button class="moreBtn" onclick="location.href='/requestDetail/<%= request.request_id %>'">> 자세히 보기</button>
							</div>
						</div>
					</div>
				</div>
			<% } %>
		</div>
		

		<!-- <div class="request-cards-container" >
			<% for (let i = 0; i < 8; i++) { 
				const request = requests[i]; 
				const minutesAgo = (Date.now() - new Date(request.updated_at)) / 1000 / 60
					let updated = ''
					if (minutesAgo < 60) {
						updated += parseInt(minutesAgo) + '분'
					} else if (minutesAgo / 60 <= 48) {
						updated += parseInt(minutesAgo / 60) + '시간'
					} else {
						updated += minutesAgo / 60 / 24 + '일'
					} %>
				<div class="col">
					<div class="card h-100" style="border-radius: 20px">
						<img src= <%= request.user.cats[0].image %> class="card-img-top" alt="...">
						<div class="card-body">
						<h5 class="card-title">기간: <%= request.reserved_time %></h5>
						<div class="d-flex justify-content-between">
							<h5 class="card-title">이름: <%= request.user.nickname %></h5>
							<button class="btn btn-outline-secondary" type="button">쪽지하기</button>
						</div>
						<h5 class="card-title">지역: <%= request.request_id %></h5>
						</div>
						<div class="card-footer">
							<div class="d-flex justify-content-between">
								<small class="text-muted align-center"><%= updated %> 전 업데이트</small>
								<button onclick="location.href='/requestDetail/<%= request.request_id %>'" class="btn btn-outline-dark btn-sm" type="button">자세히</button>
							</div>
						</div>
					</div>
				</div>
			<% } %>
		</div> -->
	</div>
</section>

<script>

	$(document).ready(function () {
		// viewRequests();
	})

	async function viewRequestCards() {
		$.ajax({
			type: 'GET',
			url: '/requests',
			success: function (response) {
				let tempHtml
				for (let i = 0; i < 3; i++) {
					console.log(response);
					console.log(`Treating ${i}th request card...`)

					const request = response[i];
					console.log(request.updated_at, new Date(request.updated_at))
					const minutesAgo = (Date.now() - new Date(request.updated_at)) / 1000 / 60
					let updated = ''
					if (minutesAgo < 60) {
						updated += parseInt(minutesAgo) + '분'
					} else if (minutesAgo / 60 <= 48) {
						updated += parseInt(minutesAgo / 60) + '시간'
					} else {
						updated += minutesAgo / 60 / 24 + '일'
					}
					

					tempHtml += `<div class="col">
						<div class="card h-100" style="border-radius: 20px">
							<img src=${request.user.cats[0].image} class="card-img-top" alt="...">
							<div class="card-body">
							<h5 class="card-title">기간: ${request.reserved_time}</h5>
							<div class="d-flex justify-content-between">
								<h5 class="card-title">이름: ${request.user.nickname}</h5>
								<button class="btn btn-outline-secondary" type="button">쪽지하기</button>
							</div>
							<h5 class="card-title">지역: ${request.request_id}</h5>
							</div>
							<div class="card-footer">
							<small class="text-muted">${updated} 전 업데이트</small>
							</div>
						</div>
						</div>`
				$('#request-cards-container').append(tempHtml);
				console.log(response);
				}
			},
			error: function (response) {
				console.log(response.responseJSON.message);
			}
		})
	}
</script>
